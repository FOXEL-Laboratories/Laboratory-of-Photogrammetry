\documentclass[a4paper, 10pt]{article}

\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{bbm}
\usepackage{lscape}
\usepackage{inputenc}
\usepackage{lmodern}
\usepackage{url}
\usepackage{float, graphicx}
\usepackage[sectionbib]{chapterbib}

\author{ St\'ephane Flotron, Pierre Moulon }
\title{\textbf{A new Global Pipeline solving the non-central camera SfM}}

\renewcommand{\tilde}{\widetilde}
\renewcommand{\t}{\mathbf{t}}
\renewcommand{\d}{\mathbf{d}}
\newcommand{\m}{\mathbf{m}}
\newcommand{\x}{\mathbf{x}}
\newcommand{\X}{\mathbf{X}}
\newcommand{\y}{\mathbf{y}}
\newcommand{\0}{\mathbf{0}}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\I}{\mathbb{I}}

\begin{document}
   \maketitle
   
   \section{ Preambule }
   
   \subsection{On the Plücker line representation}
   
   Let $L$ be a line of the 3D space $\R^3$ defined by the point $\x$ and $\y$. Let us now define $\d$ as 
   \begin{equation*}
       \d = \y-\x.
   \end{equation*}
   Then, The Cartesian representation of the line $L$ is 
   \begin{equation*}
       L : \x + \alpha \d, \ \alpha \in \R.
   \end{equation*}
   This representation of the line does not allow the use of homogeneous coordinates. Hence, a solution is to use Plücker
   line representation of $L$, $L : (\d,\m)$, where $\d$ and $\m$ are two vectors of $\R^3$ defined as :
   \begin{equation}
        \label{dandm}
       \d = \y-\x \mbox{ and } \m = (\x-\0) \wedge (\y-\0),
   \end{equation}
   where $\0$ is the origin of $\R^3$.
   
   \paragraph{}We are now interested us to intersection of lines represented in Plücker coordinates frame.
   Let $L_1 : (\d_1, \m_1)$ and $L_2 : (\d_2, \m_2)$ two lines of $\R^3$ represented by Plücker
   line coordinates. $L_1$ intersect $L_2$ if and only if $L_1$ and $L_2$ are coplanar. In terms of Plücker 
   coordinates, this condition is the following :
   \begin{equation}
       \label{co-planarity condition}
       L_1 \cap L_2 \neq \emptyset \iff \d_1 \cdot \m_2 + \d_2 \cdot \m_1 = 0.
   \end{equation}

   \subsubsection*{Remark}
    In the case where $\x$ and $\y$ belongs to $\P^3$, the above definition of $\d$ and $\m$ doest not hold anymore.
    Let us defined $p_{ij}$ as 
    \begin{equation*}
        p_{ij} = \left| 
             \begin{array}{cc}
                x_i & y_i \\
                x_j & y_j 
            \end{array}
        \right|.
    \end{equation*}
    Then $\d$ and $\m$ are defined as
    \begin{equation}
           \d^T = (p_{01},\ p_{02},\ p_{03}) \mbox{ and } \m^T = (p_{23},\ p_{31},\ p_{12}). 
    \end{equation}
    Taking $\x = (1, x_1, x_2, x_3)$, $\y = (1, y_1, y_2, y_3)$ and using the above definition, 
    we recover $\d$ and $\m$ defined by relation \eqref{dandm}.
    
    \subsubsection{Rigid transformation of line represented by Plücker coordinates}
    
    Let $\x$ and $\y$ be two vectors of $\R^3$ defining a line $L$. Here, we represent $L$ using Plücker line
    coordinates, $L : (m,d)$. We apply to $L$ the rigid transformation $f(\X) = R( \X-\t), \ \forall \X \in \R^3$, 
    where $R$ is a rotation matrix and $\t \in \R^3$. Denoting $L'=f(L)$ with Plücker coordinate $(\d', \m')$, 
    how are $\d'$ and $\m'$ related to $\m$ and $\d$ ? Using the definition \eqref{dandm} of $\d$ and $\m$, we have
    \begin{eqnarray*}
         \d' & = & f(\y) - f(\x) \\
             & = & R(\y-\t) -R(\x-\t) \\
             & = & R\y - R\x \\
             & = & R(\y-\x) \\
             & = & R\d.
    \end{eqnarray*}
    Similary, we have
    \begin{eqnarray*}
        \m' & = & f(\x) \wedge f(\y) \\
            & = & R(\x-\t) \wedge R(\y-\t) \\
            & = & R \x \wedge R\y - R\t \wedge R \y - R\x \wedge R \t \\
            & = & R( \x \wedge \y) - R\t \wedge R(\y-\x) \\
            & = & R( \x \wedge \y) - R( \t \wedge (\y -\x) \\
            & = & R \m - R ( \t \wedge \d ).
    \end{eqnarray*}
    Hence, for the rigid transformation $f$ defined by $f(\X) = R(\X-\t)$, we have
    \begin{equation}
       \label{plucker-transform}
        \d' = R\d \mbox{   and   } \m' = R\m - R ( \t \wedge \d ).
    \end{equation}
    The relation \eqref{plucker-transform} will be very useful to derive the generalized epipolar constraint.
    
    \subsection{The generalized epipolar camera model}

    Let $L_1$ and $L_2$ be rays related to the same 3D point seen by two cameras, respectively camera 1 and camera 2. We suppose that the Plücker line
    representation of $L_1$ and $L_2$ are known and denoted by
    \begin{equation*}
         L_1 : (\d_1, \m_1) \mbox{   and   } L_2 : (\d_2, \m_2 ).
    \end{equation*}
    We equally assume that $L_1$ in represented in camera 1 coordinate frame and that $L_2$ in represented in camera 2 coordinate frame.
    Without loss of generality, we can assume that camera 1 has pose $(\I_3 | \0)$ and that camera 2 has pose $(R, \t)$, where $R$ the orientation of
    the second camera with respect to the first and $\t$ the translation of second camera if camera 1 coordinate frame. 
    Denoting by $\X$ a point in camera one coordinate frame, it could be expressed in camera 2 coordinate frame by
    $$ \x_{cam}^2 = R\x_{cam}^1 + \t.$$
    Therefore, the coordinate of camera two expressed in camera one coordinate frame are 
    $
        \x_{cam}^1 = R^T( \x_{cam}^2 - \t). 
    $
    Hence, $L_2$ in camera one coordinate frame is given by :
    \begin{equation}
        L^2 : (R^T \d_2, R^T \m_2 - R^T (\t \wedge \d_2).
    \end{equation}
    Since $L_1$ and $L_2$ are seeing the same 3D point $\X$, the lines must intersect. From condition \eqref{co-planarity condition}, we have
    \begin{equation*}
        \d_1^T R^T \m_2 - \d_1^T R^T (\t \wedge \d_2 ) + \m_1^T R^T \d_2 = 0,  
    \end{equation*}
    which is equivalent to 
    \begin{equation}
        \label{ray intersection}
        \m_2^T R \d_1 + \d_2^T [\t]_{\times} R \d_1 + \d_2^T R \m_1 = 0.
    \end{equation}
    Writing equation \eqref{ray intersection} in a matrix product, we obtain the following expression
    \begin{equation}
        \label{generalized epipolar}
        (\d_2^T\ \m_2^T ) \left[ 
          \begin{array}{cc}
              [\t]_{\times} R & R \\
              R & \0 
          \end{array}
           \right] 
           \left( 
               \begin{array}{c}
                   \d_1 \\
                   \m_1
               \end{array}
           \right)
           = 0
    \end{equation}
    which the generalized epipolar condition. Let us remark that if we consider central camera, the momentums $\m_1$ and $\m_2$
    are equal to $\0$ because the rays passes through the origin. Then relation \eqref{generalized epipolar} reduces to
    $$ \d_2^T [\t]_{\times} R \d_1 = 0$$
    which is nothing else than the classical epipolar condition. Therefore \eqref{generalized epipolar} is really
    a generalization of the epipolar condition.
    
   \section{Relative Rotation Estimation}

    
   \section{Relative translation Estimation}
   
   During this section, we assume that the rotation $R_i$ of each pose $i$ is known. The aim of this section is to develop
   a numerical scheme in order to estimation the relative translations $\t_{ij}$ between two poses. Once the are known, 
   the relative translations could be merged using the approach of \cite{moulon-tel-00996935} in order to retrieve the global translations.
   
   \subsection{Parametric model (reduced trifocal tensor)} 
   We assume here that the tracks between the poses are know, i.e that correspondences between the sub cameras
   of the camera rigs are known. The tracks are assumed to be of length at least 3, so that the corresponding 3D point is
   seem from at least three poses. The method that will be presented hereafter is base on the one developed by Pierre Moulon
   (see \cite{moulon-tel-00996935} chapter 6, section 6.2.3, p.129 for the original method). Following \cite{moulon-tel-00996935}, 
   we define the interpose similarity measure as the re-projection error defined by 
    \begin{equation}
        \label{similarity}
        \begin{aligned}
        & \rho(\t_i, X_j) && = \left \| \left (
                              x_j^{c,i}(1) - \frac{(R_c R_i X_j + R_c \t_i + \t_c)^1}{(R_c R_i X_j + R_c \t_i + \t_c)^3}, \right. \right. \\
                           &&& \qquad \qquad \qquad  \left. \left. x_j^{c,i}(2) - \frac{(R_c R_i X_j + R_c \t_i + \t_c)^2}{(R_c R_i X_j + R_c \t_i + \t_c)^3}
                          \right) \right\|_\infty
        \end{aligned}
    \end{equation}
    where
    \begin{itemize}
        \item[$x_j^{c,i}$] is the pixel of sub-camera $c$ of pose $i$ corresponding to 3D point $X_j$ 
        \item[$X_j$] is a 3D,
        \item[$R_c$] is the relative orientation of the sub-camera $c$ in the camera rig referential frame,
        \item[$R_i$] is the orientation of pose $i$,
        \item[$\t_i$] is the translation of pose $i$,
        \item[$\t_c$] is the translation of sub-camera $c$ in the camera rig referential frame.
    \end{itemize}
   
   Le be $(I,J,K)$ a triplet of poses such that the composition of the relative rotation is the 
   identity matrix, i.e.
   $$ R_{IJ} R_{JK} R_{KI} = I_3.$$ 
   where $R_{ij}$ is the relative orientation of rig $j$ in the pose $i$. 
   The problem we want to solve in order to estimate the relative translation
   $\t_1 = \mathbf{0}, \t_2= \t_{IJ}, \t_3 = \t_{IK}$ between the poses $I, J$ and $K$ is 
   \begin{equation}
       \label{parametric model}
       \begin{aligned}
           \mbox{minimize}_{\{\t_i\}_i, \{X_j\}_j}  && \quad  & \gamma &&& \\
           &&&&&\\
           \mbox{such that} && \ & \rho(\t_i, X_j) \leq \gamma && \forall i, j \in \{1,2,3,4\} \\
            & && (R_c R_i X_j + R_c \t_i + \t_c)^3 \geq 1 & \ & \forall i,j \\
            &&& \t_1 = (0,0,0) &&
       \end{aligned}
   \end{equation}
   Only 4 3D-points are needed to estimate the relative translations between the three poses. 
   The model would be estimated using AC-RANSAC with an upper bound threshold of $\gamma=2.0$ pixels. For more information
   about the mathematical basis of the model, we refer us to \cite{moulon-tel-00996935}.
   
   \subsection{Note}
   The constraint $\rho(\t_i, X_j) \leq \gamma$ is equivalent to 
   \begin{equation*}
     \left\{
         \begin{aligned}
            & X_j\left[ (R_cR_i)^k + (\gamma-x_j^{c,i}(k)) (R_cR_i)^3 \right] + \left[R_c^3(\gamma-x_j^{c,i}(k))+R_c^k\right]\t_i  \\
            & \qquad \qquad + [\t_c^k + (\gamma-x_j^{c,i}(k))\t_c^3] \geq 0 \\
            & X_j\left[ (R_cR_i)^k - (\gamma + x_j^{c,i}(k)) (R_cR_i)^3 \right] + \left[-R_c^3(\gamma+x_j^{c,i}(k))+R_c^k\right]\t_i  \\
            & \qquad \qquad + [\t_c^k - (\gamma+x_j^{c,i}(k))\t_c^3] \leq 0 \\
         \end{aligned}
       \right\}, \\ \forall k \in {1,2}.
   \end{equation*}
   Because $R_c$ et $\t_c$ are known from calibration, the previous problem is linear in $R_i$ and $\t_i$.
   
   \section{Conclusions}
   
% ================================================================
%  Bibliography
% ================================================================

  \bibliography{biblio}
  \bibliographystyle{acm}
%  \bibliographystyle{plain}
   
\end{document}
